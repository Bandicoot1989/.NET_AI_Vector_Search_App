@page "/"
@rendermode InteractiveServer
@using RecipeSearchWeb.Services
@using RecipeSearchWeb.Models
@inject ScriptSearchService ScriptService
@inject KnowledgeSearchService KnowledgeService
@inject NavigationManager Navigation

<PageTitle>Operations One - Control Centre</PageTitle>

<div class="ops-centre">
    @* Hero Section *@
    <div class="hero-section">
        <div class="hero-content">
            <div class="hero-badge">OPERATIONS TEAM</div>
            <h1 class="hero-title">
                <span class="title-accent">Operations</span> One
            </h1>
            <p class="hero-subtitle">Unified Control Centre for IT Operations</p>
            <p class="hero-description">Grupo Antolin • Automation & Technical Support</p>
        </div>
        <div class="hero-stats">
            <div class="stat-item">
                <span class="stat-number">@totalScripts</span>
                <span class="stat-label">Scripts</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">@totalDocs</span>
                <span class="stat-label">Documents</span>
            </div>
        </div>
        <div class="hero-credits">
            <span>Built with <strong>GitHub Copilot</strong> using <strong>Claude Sonnet 4</strong> & <strong>Claude Opus 4</strong></span>
        </div>
    </div>

    @* Quick Access Grid *@
    <div class="section-header">
        <h2>🚀 Quick Access</h2>
        <p>Jump to the tools you need</p>
    </div>

    <div class="quick-access-grid">
        <div class="access-card primary" @onclick='() => NavigateTo("/scripts")'>
            <div class="card-icon">⚡</div>
            <div class="card-content">
                <h3>PowerShell Scripts</h3>
                <p>Browse and search the script library</p>
                <span class="card-action">Open Library →</span>
            </div>
        </div>

        <div class="access-card" @onclick='() => NavigateTo("/knowledge")'>
            <div class="card-icon">📚</div>
            <div class="card-content">
                <h3>Knowledge Base</h3>
                <p>Documentation & procedures</p>
                <span class="card-action">Browse Docs →</span>
            </div>
        </div>

        <div class="access-card disabled">
            <div class="card-icon">📊</div>
            <div class="card-content">
                <h3>Monitoring</h3>
                <p>System health & alerts</p>
                <span class="card-action coming-soon">Coming Soon</span>
            </div>
        </div>
    </div>

    @* Featured Scripts Section *@
    <div class="section-header">
        <h2>⭐ Featured Scripts</h2>
        <p>Most useful automation tools</p>
        @* View All - disabled until more sections are implemented *@
    </div>

    <div class="featured-scripts">
        @if (featuredScripts.Any())
        {
            @foreach (var script in featuredScripts.Take(4))
            {
                <div class="script-card" @onclick="() => ShowScriptDetails(script)">
                    <div class="script-category">
                        <span>@script.CategoryEmoji</span>
                        <span>@script.Category</span>
                    </div>
                    <h4>@script.Name</h4>
                    <p>@(script.Description.Length > 80 ? script.Description.Substring(0, 80) + "..." : script.Description)</p>
                    <div class="script-meta">
                        <span class="complexity @script.Complexity.ToLower()">@script.Complexity</span>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="loading-placeholder">Loading scripts...</div>
        }
    </div>

    @* Recent Activity & Quick Links *@
    <div class="bottom-grid">
        <div class="activity-section">
            <div class="section-header-sm">
                <h3>📋 Quick Actions</h3>
            </div>
            <div class="quick-actions">
                <button class="action-btn" @onclick='() => NavigateTo("/scripts")'>
                    <span class="action-icon">🔍</span>
                    <span>Search Scripts</span>
                </button>
                <button class="action-btn" @onclick='() => NavigateTo("/knowledge")'>
                    <span class="action-icon">📖</span>
                    <span>Browse Documentation</span>
                </button>
                <button class="action-btn" @onclick='() => NavigateTo("/editor")'>
                    <span class="action-icon">✏️</span>
                    <span>Create New Script</span>
                </button>
            </div>
        </div>

        <div class="info-section">
            <div class="section-header-sm">
                <h3>ℹ️ System Info</h3>
            </div>
            <div class="info-cards">
                <div class="info-item">
                    <span class="info-label">Status</span>
                    <span class="info-value status-online">● Online</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Last Update</span>
                    <span class="info-value">@DateTime.Now.ToString("MMM dd, yyyy")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Version</span>
                    <span class="info-value">2.0.0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Environment</span>
                    <span class="info-value">Production</span>
                </div>
            </div>
        </div>
    </div>

</div>

@* Script Details Modal *@
@if (selectedScript != null)
{
    <div class="modal-overlay" @onclick="CloseModal">
        <div class="modal-content" @onclick:stopPropagation="true">
            <button class="modal-close" @onclick="CloseModal">✕</button>
            
            <div class="modal-header">
                <div class="modal-category">
                    <span class="category-emoji-large">@selectedScript.CategoryEmoji</span>
                    <span class="category-badge">@selectedScript.Category</span>
                </div>
                <h2 class="modal-title">@selectedScript.Name</h2>
            </div>
            
            <div class="modal-body">
                <div class="modal-section">
                    <h3>📝 Description</h3>
                    <p>@selectedScript.Description</p>
                </div>
                
                <div class="modal-meta">
                    <div class="meta-item">
                        <span class="meta-icon">📊</span>
                        <div>
                            <div class="meta-label">Complexity</div>
                            <div class="meta-value difficulty-@selectedScript.Complexity.ToLower()">@selectedScript.Complexity</div>
                        </div>
                    </div>
                    <div class="meta-item">
                        <span class="meta-icon">🎯</span>
                        <div>
                            <div class="meta-label">Purpose</div>
                            <div class="meta-value">@selectedScript.Purpose</div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>💻 PowerShell Code</h3>
                    <pre class="code-block"><code>@selectedScript.Code</code></pre>
                    <button class="copy-button" @onclick="CopyCode">📋 Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private List<Script> featuredScripts = new();
    private Script? selectedScript;
    private int totalScripts = 0;
    private int totalDocs = 0;

    protected override async Task OnInitializedAsync()
    {
        var allScripts = await ScriptService.SearchScriptsAsync("", 100);
        featuredScripts = allScripts.Take(4).ToList();
        totalScripts = allScripts.Count;
        
        // Get real document count from Knowledge Base
        var allDocs = KnowledgeService.GetAllArticles();
        totalDocs = allDocs.Count;
    }

    private void NavigateTo(string url)
    {
        Navigation.NavigateTo(url);
    }

    private void ShowScriptDetails(Script script)
    {
        selectedScript = script;
    }

    private void CloseModal()
    {
        selectedScript = null;
    }

    private async Task CopyCode()
    {
        await Task.CompletedTask;
    }
}
